\documentclass[12pt]{beamer}

\input{../Include/packages.tex}

\usetheme{Madrid}
\usecolortheme{whale}

\newcounter{listnum}

\title{Mikrocontroller Touchscreen GUI}
\author{Neo Hornberger, Tim Ludwig}
\date{21.01.2022}

\bibliography{../Bibliography.bib}

\begin{document}
	\maketitle
	
	\section{Touchscreen Hardware}
	\frame{\tableofcontents[currentsection]}
	
	\begin{frame}{Resistive Touchscreens}
		\begin{columns}
			\begin{column}{0.4\textwidth}
				\includegraphics[width=\textwidth]{../Images/ResistiveTouchScreen.png}
			\end{column}
			\begin{column}{0.6\textwidth}
				Funktionsweise: 
				\begin{itemize}
					\item<1-> Kontakt zweier Schichten durch Deformierung
					\item<2-> Anlegen einer Spannung über eine Schicht
					\item<3-> Messen des Potentials an den Enden der anderen Schicht
					\item<4-> Wdh. mit vertauschten Rollen
				\end{itemize}
				
				Häufige Nutzung:
				\begin{itemize}
					\item Kiosksysteme
					\item Industrie
					\item \dots
				\end{itemize}
			\end{column}
		\end{columns}
	\end{frame}

	\begin{frame}{kapazitive Touchscreens}
		Arten von kapazitiven Touchscreens:
		\begin{itemize}
			\item Oberflächen-kapazitiv
			\item Projiziert-kapazitiv
		\end{itemize}
		\medskip
		Häufige Nutzung:
		\begin{itemize}
			\item Smartphones
			\item Tablets
			\item \dots
		\end{itemize}
	\end{frame}

	\begin{frame}{Oberflächen-kapazitive Touchscreens}
		\begin{columns}
			\begin{column}{0.4\textwidth}
				\includegraphics[width=\textwidth]{../Images/SurfaceCapacitiveTouchScreen.png}
				
			\end{column}
			\begin{column}{0.6\textwidth}
				Funktionsweise:
				\begin{itemize}
					\item<1-> Wechselspannung an den Ecken anlegen
					\item<2-> bei Berührung wird eine Kapazität auf- und entladen
					\item<3-> den Strom durch die Ecken messen
				\end{itemize}
			\end{column}
		\end{columns}
	\end{frame}
	
	\begin{frame}{Projiziert-kapazitive Touchscreens}
		\begin{columns}
			\begin{column}{0.4\textwidth}
				\includegraphics[width=\textwidth]{../Images/ProjectedCapacitiveTouchScreen.png}
			\end{column}
			\begin{column}{0.6\textwidth}
				Funktionsweise:
				\begin{itemize}
					\item<1-> zwei Ebenen Gitter aus Leitern
					\item<2-> Anlegen einer Wechselspannung an eine Ebene
					\item<3-> Messen des durch die Leiter der anderen Ebene fließenden Stroms
				\end{itemize}
			\end{column}
		\end{columns}
	\end{frame}
	
	\begin{frame}{Kapazitiv vs. Resistiv}
		\begin{tabular}{| >{\columncolor{structure.fg!80}\color{white}} l | p{4.5cm} | p{4.5cm} |}
			\hline
			\rowcolor{structure.fg!80} & \color{white}Vorteile & \color{white}Nachteile\\\hline
			kapazitiv & \normalcolor
				\begin{itemize}
					\item geringer Verschleiß
					\item Multitouch
				\end{itemize} &
				\begin{itemize}
					\item leitendes Material (Finger, spez. Stifte, \dots) notwendig
					\item Kalibration
				\end{itemize}\\\hline
			resistiv &
				\begin{itemize}
					\item ohne leitendes Material bedienbar
					\item unempfindlich gegenüber Staub, Wasser, \dots
				\end{itemize} &
				\begin{itemize}
					\item erhöhter Verschleiß
					\item unerwünschtes Auslösen
				\end{itemize}\\\hline
		\end{tabular}
	\end{frame}

	\section{I²C}
	\frame{\tableofcontents[currentsection]}
	
	\begin{frame}{Der I²C-Bus}
		\begin{itemize}
			\item Bussystem bestehend aus zwei Leitungen (\texttt{SDA}, \texttt{SCL})
			\item Aufteilung der Daten in Bytes (8-Bit-Wörter)
			\item Versenden der Bytes in MSB-Bitreihenfolge
			\item Komponenten besitzen eine 7-Bit Adresse
			\item Controller/Target-Prinzip
			\item nach jedem gesendeten Byte bestätigt der Empfänger dies
		\end{itemize}
	\end{frame}
	
	\begin{frame}{Kommunikationsstart}
		\begin{columns}
			\begin{column}{0.45\textwidth}
				\texttt{Controller}:
				\begin{enumerate}
					\item Startanweisung (\texttt{START})
					\item 7-Bit Adresse
					\item R/$\overline{\mbox{W}}$-Bit
					
					\setcounter{listnum}{\value{enumi}}
				\end{enumerate}
				\texttt{Target}:
				\begin{enumerate}
					\setcounter{enumi}{\value{listnum}}
					
					\item Bestätigung (\texttt{ACK})
				\end{enumerate}
			\end{column}
			\begin{column}{0.5\textwidth}
				\input{../Images/I2C_Communication_START.tikz}
			\end{column}
		\end{columns}
	\end{frame}

	\begin{frame}{Übertragung von Daten}
		\begin{columns}
			\begin{column}{0.45\textwidth}
				Sender:
				\begin{enumerate}
					\item 8-Bit Wort
					
					\setcounter{listnum}{\value{enumi}}
				\end{enumerate}
				
				Empfänger:
				\begin{enumerate}
					\setcounter{enumi}{\value{listnum}}
					
					\item Bestätigung (\texttt{ACK})
				\end{enumerate}
				
				\vspace{5ex}
				Wdh. bis alle Bytes versendet sind.
			\end{column}
			\begin{column}{0.5\textwidth}
				\input{../Images/I2C_Communication_DATA.tikz}
			\end{column}
		\end{columns}
	\end{frame}

	\begin{frame}{Kommunikationsende}
		\begin{columns}
			\begin{column}{0.55\textwidth}
				\texttt{Controller}:
				\begin{enumerate}[a]
					\item Stopanweisung (\texttt{STOP})
					\item erneute Startanweisung (\texttt{repeated START})
				\end{enumerate}
			\end{column}
			\begin{column}{0.4\textwidth}
				\input{../Images/I2C_Communication_STOP.tikz}
				\input{../Images/I2C_Communication_repSTART.tikz}
			\end{column}
		\end{columns}
	\end{frame}
	
	\section{Software}
	\frame{\tableofcontents[currentsection]}
	
	\begin{frame}{Planung \& Entwurfsziele}
		Implementation typischer Touchscreen GUI Komponenten in C++.
		\pause
		\bigskip
		\begin{itemize}
			\item leicht benutzbar $\Rightarrow$ orientiert an typischen Design Guidelines \cite{material-components} \pause
			\item leicht programmierbar $\Rightarrow$ viel Abstraktion, wenig Boilerplate \pause
			\item möglichst Ressourcen schonend $\Rightarrow$ Abfragen und zeichnen nur wenn notwendig
		\end{itemize}
	\end{frame}
	
	\subsection{Klassen}
	\begin{frame}{BoundingBox}
			\centering
		\begin{tikzpicture}
			\begin{class}[text width=11cm]{BoundingBox}{0, 0}
				\attribute{- left, top, right, bottom: WORD}
				
				\operation{+ BoundingBox(x: WORD, y: WORD, width: WORD, height: WORD)}
				\operation{+ contains(x: WORD, y: WORD): bool}
				\operation{+ resizeToFit(x: WORD, y: WORD): void}
				\operation{+ resizeToFit(box: BoundingBox\&): void}
				\operation{+ x(): WORD}
				\operation{+ y(): WORD}
				\operation{+ width(): WORD}
				\operation{+ height(): WORD}
			\end{class}
		\end{tikzpicture}
	\end{frame}
	
	\begin{frame}{Komponenten}
		\centering
		\begin{tikzpicture}
			\begin{abstractclass}[text width=11cm]{Component}{0, 0}
				\attribute{\# box: BoundingBox}
				
				\operation{+ Component(x: WORD, y: WORD, w: WORD, h: WORD)}
				\operation{+ getBoundingBox(): BoundingBox\&}
				\operation[0]{+ onEvent(event: DragEvent\&): void}
				\operation[0]{+ onEvent(event: TouchEvent\&): void}
				\operation[0]{+ onEvent(event: ReleaseEvent\&): void}
				\operation[0]{+ show(display: cDevDispalyGraphic\&): void}
			\end{abstractclass}
		\end{tikzpicture}
	\end{frame}

	\begin{frame}{Container}
		\centering
		\begin{tikzpicture}
			\begin{abstractclass}[text width=3cm]{Component}{0, 0}
			\end{abstractclass}
			
			\begin{class}[text width=11cm]{Container}{0, -2.5}
				\inherit{Component}
				
				\attribute{- compontents: list<Component*>}
				
				\operation{+ addComponent(comp: Component*): void}
				\operation{+ removeComponent(comp: Component*): void}
			\end{class}
		\end{tikzpicture}
	\end{frame}

	\begin{frame}{Slider}
		\centering
		\begin{tikzpicture}
			\begin{abstractclass}[text width=3cm]{Component}{-4, 0}
			\end{abstractclass}
			
			\node[right=of Component] (image) {\includegraphics[height=2cm]{../Images/Slider.png}};
			
			\begin{class}[text width=11cm]{Slider}{0, -2.5}
				\inherit{Component}
				
				\attribute{- position: double}
				\attribute{- listeners: list<function<void(SliderEvent\&)>\relax>}
				
				\operation{- setPosition(x: WORD): void}
				\operation{+ getPosition(): double}
				\operation{+ addEventListener(listener: function<void(SliderEvent\&)>): void}
			\end{class}
		\end{tikzpicture}
	\end{frame}

	\begin{frame}{Toggle Switch}
		\centering
		\begin{tikzpicture}
			\begin{abstractclass}[text width=3cm]{Component}{-4, 0}
			\end{abstractclass}
			
			\node[right=of Component] (image) {\includegraphics[height=2cm]{../Images/Switch.png}};
			
			\begin{class}[text width=11cm]{ToggleSwitch}{0, -2.5}
				\inherit{Component}
				
				\attribute{- state: bool}
				\attribute{- listeners: list<function<void(ToggleSwitchEvent\&)>\relax>}
				
				\operation{+ getState(): bool}
				\operation{+ addEventListener(listener: function<void(ToggleSwitchEvent\&)>): void}
			\end{class}
		\end{tikzpicture}
	\end{frame}

	\begin{frame}{Radio Button}
		\centering
		\begin{tikzpicture}
			\begin{abstractclass}[text width=3cm]{Component}{-4, 0}
			\end{abstractclass}
			
			\node[right=of Component] (image) {\includegraphics[height=2cm]{../Images/RadioButton.png}};
			
			\begin{class}[text width=11cm]{RadioButton}{0, -2.5}
				\inherit{Component}
				
				\attribute{- state: bool}
				\attribute{- deselectable: bool}
				\attribute{- listeners: list<function<void(RadioButtonEvent\&)>\relax>}
				
				\operation{+ getState(): bool}
				\operation{+ addEventListener(listener: function<void(RadioButtonEvent\&)>): void}
			\end{class}
		\end{tikzpicture}
	\end{frame}

	\begin{frame}{TouchScreen}
		\centering
		\begin{tikzpicture}
			\begin{class}[text width=11cm]{TouchScreen}{0, 0}
				\attribute{- x, y: WORD}
				\attribute{- touchCount: WORD}
				\attribute{- width, height: WORD}
				\attribute{- i2cTouch: cHwI2Cmaster::Device\&}
				\attribute{- interruptPort: cHwPort\_N::PortId}
				\attribute{+ interruptPin: BYTE}
				\attribute{+ rootContainer: Container*}
				\attribute{+ \emph{static} INSTANCE: TouchScreen*}
				
				\operation{+ refresh(): void}
				\operation{+ setInterruptMode(mode: bool): void}
				\operation{+ interruptHandler(): void}
				\operation{+ setRootContainer(c: Container*): void}
				\operation{+ getRootContainer(): Container*}
			\end{class}
		\end{tikzpicture}
	\end{frame}

	\begin{frame}{Beispiel GUI}
		\centering\input{../Images/Components.tikz}
	\end{frame}

	\begin{frame}{Das Event System}
		\begin{columns}
			\begin{column}{0.6\textwidth}
				\input{../Images/EventCallHierarchy.tikz}
			\end{column}
			\begin{column}{0.4\textwidth}
				\pause
				Berührung außerhalb der \emph{Bounding-Box} von \texttt{Slider}.
			\end{column}
		\end{columns}
		
	\end{frame}

	\section{Quellen}
	\begin{frame}{Quellen}
		\nocite{ts-holzinger}
		\nocite{I2C-spec_userManual}
		\nocite{stm32_refManual}
		\printbibliography
	\end{frame}
\end{document}
